<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cykj.mapper.BusInfMapper" >

  <insert id="addBus" parameterType="BusInf">
    insert into t_bus(busId, busName, carNum, importTime, busState, onloadState)value (#{busId}, #{busName}, #{carNum},
       sysdate(), 17, 13)
  </insert>

    <delete id="deleteBus" parameterType="java.lang.Integer">
    delete from t_bus where busId = #{busId}
  </delete>

    <update id="updateBus" parameterType="BusInf">
        update t_bus
        <set>
            <if test="busName !=null and busName !=''">
                busName = #{busName},
            </if>
            <if test="carNum !=null and carNum !=''">
                carNum = #{carNum},
            </if>
            <if test="importTime !=null and importTime !=''">
                importTime = sysdate(),
            </if>
            <if test="busState !=null and busState !=''">
                busState = #{busState},
            </if>
            <if test="onloadState !=null and onloadState !=''">
                onloadState = #{onloadState},
            </if>
            <if test="driverName !=null and driverName !=''">
                driverName = #{driverName},
            </if>
            <if test="sixTime !=null and sixTime !=''">
                sixTime = #{sixTime},
            </if>
        </set>
        where busId = #{busId}
    </update>

    <select id="selectBus" resultType="BusInf" parameterType="HashMap">
  select b.*,d.dicValue from t_bus b left join t_dic d on b.busState = d.dicId left join t_dic d1 on b.onloadState = d1.dicId
        <where>
                and busState !='16'

            <if test="busName != null and busName !=''">
                and busName like CONCAT('%',#{busName},'%')
            </if>

        </where>
        limit #{start},#{end};
  </select>

    <select id="selectBusWeiXiu" resultType="BusInf" parameterType="HashMap">
        select b.*,d.dicValue from t_bus b left join t_dic d on b.busState = d.dicId left join t_dic d1 on b.onloadState = d1.dicId
        <where>
            and busState ='16'

            <if test="busName != null and busName !=''">
                and busName like CONCAT('%',#{busName},'%')
            </if>

        </where>

        limit #{start},#{end};
    </select>

    <resultMap id="BusInf" type="BusInf">
        <id property="busId" column="busId"></id>
        <result property="busName" column="busName"></result>
        <result property="carNum" column="carNum"></result>
        <result property="importTime" column="importTime"></result>
        <result property="busState" column="busState"></result>
        <result property="onloadState" column="onloadState"></result>
        <association property="dic" javaType="Dic">
            <result column="dicValue" property="dicValue"></result>
        </association>
    </resultMap>

    <select id="count" resultType="int" parameterType="java.util.HashMap">
        select count(*) from t_bus where 1=1
        <if test="busName != null and busName !=''">
            and busName like CONCAT('%',#{busName},'%')
        </if>
    </select>


    <!--修改状态-->
    <update id="updateState" parameterType="BusInf">
        update t_bus set busState= '16',sixTime=sysdate()
        <where>
            busId=#{busId};
        </where>
    </update>
</mapper>